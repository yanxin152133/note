# 1. RAID技术
## 1.1. 传统RAID技术
### 1.1.1. RAID技术背景
>在单机时代，采用单块磁盘进行数据存储和读写的方式，由于寻址和读写的时间消耗，导致I/O性能非常低，且存储容量还会受到限制。另外，单块磁盘极其容易出现物理故障，经常导致数据的丢失。因此大家就在想，有没有一种办法将多块独立的磁盘结合在一起组成一个技术方案，来提高数据的可靠性和I/O性能呢。
          
![](https://live.staticflickr.com/65535/50586207996_c3e06172eb_h.jpg)
      
### 1.1.2. RAID基本概念
>RAID （ Redundant Array of Independent Disks ）即独立磁盘冗余阵列，简称为「磁盘阵列」，旧称廉价磁盘冗余阵列（Redundant Array of Inexpensive Disks）,其实就是用多个独立的磁盘组成在一起形成一个大的磁盘系统，从而实现比单块磁盘更好的存储性能和更高的可靠性。
      
实现方法：硬件RAID和软件RAID。
       
### 1.1.3. RAID的数据组织形式
- 硬盘的条带化：将硬盘空间按照设定的大小分为多个条带，数据写入时也按照条带的大小来划分数据模块。
- 条带（strip）：硬盘中单个或者多个连续的扇区构成一个条带，是组成分条的元素。
- 分条（stripe）：同一硬盘阵列中的多个硬盘驱动器上的相同“位置”（或者说是相同编号）的条带。
        
![](https://live.staticflickr.com/65535/50585513133_32722ab28d_h.jpg)
      
### 1.1.4. RAID的数据保护方式
- 方法一：镜像（Mirroring），在另一块冗余的硬盘上保存数据的副本。
+ 方法二：奇偶校验算法（XOR）。
    - XOR运算广泛地使用在数字电子和计算机科学中。
    - XOR校验的算法--**相同为假，相异为真**。
       
![](https://live.staticflickr.com/65535/50588860077_90a0357283_h.jpg)
        
### 1.1.5. 常用RAID级别与分类标准
根据不同的组合方式可以分为不同的RAID级别。
             
![](https://live.staticflickr.com/65535/50588000558_d343b5ac7e_h.jpg)
        
### 1.1.6. 磁盘阵列比较表
|RAID等级|最少硬盘|最大容错|可用容量|读取性能|写入性能|安全性|目的|应用产业|
|----|----|----|----|----|----|----|----|----|
|单一硬盘|（参考）|0|1|1|1|无|||
|JBOD|1|0|n|1|1|无（同RAID0）|增加容量|个人（暂时）存储备份|
|0|2|0|n|n|n|一个硬盘异常，全部硬盘都会异常|追求最大容量、速度|影片剪接缓存用途|
|1|2|n-1|1|n|1|高，一个正常即可|追求最大安全性|个人、企业备份|
|5|3|1|n-1|n-1|n-1|中下至中|追求最大容量、最小预算|个人、小型企业备份|
|6|4|2|n-2|n-2|n-2|中至中高,仅安全性较RAID 5高|同RAID 5，但较安全|个人、企业备份|
|10|4|||||高|综合RAID 0/1优点，理论速度较快|大型数据库、服务器|
|50|6|||||高|提升资料安全||
|60|8|||||高|提升资料安全||
       
1. n代表硬盘总数
2. JBOD（Just a Bunch Of Disks）指将数个物理硬盘，在操作系统中合并成一个逻辑硬盘，以直接增加容量
3. 依不同 RAID 厂商实现算法对于性能表现会有不同，性能公式仅供参考
4. RAID 10、50、60 依实现 Parity 不同公式也不同
       
### 1.1.7. RAID0
>原理：将数据条带化，最少需要两块硬盘（每块硬盘的容量一样，实际生产环境中建议使用同品牌同型号同批次同容量的硬盘组成 RAID 0），即将所有组成 RAID 0 的硬盘的可用容量组合在一起，形成计算机上的一个逻辑卷。通俗的讲就是至少使用两块硬盘来存储数据，但是我要存储的数据不是全部存在某一块硬盘上，而是把我要存储的数据分成均等的多部分，然后平均分散存储在组成 RAID 0 的磁盘阵列上。
         
下图是用四块硬盘组成 RAID 0 的示意图，其中每块硬盘都被分成 ABCD 四个条带，然后我要存数据就先存把数据均分成四部分，如果 A1 能存下其中一份，那就直接将四部分分别存入 A1-A4，如果存不下就先存满 A1-A4，剩下的按同样的方式存 B1-B4，以此类推。
       
![](https://live.staticflickr.com/65535/50588186223_a7ac760a4e_n.jpg)
       
- 可用容量：组成RAID0所有硬盘容量的总和
+ 优点：
    - 提高读写速度，对硬盘的总容量没有损失
    - 处理大文件很快
+ 缺点：
    - 一旦阵列中某块硬盘损坏了，所有数据将不可恢复。
        
### 1.1.8. RAID1
>原理：镜像存储，RAID 1 至少需要两块硬盘组成，两块硬盘互为备份，存储的内容完全相同。建议硬盘容量大小也要一样，如果不一样，那实际可用容量不超过较小的那块硬盘的容量。
       
下图是 RAID 1 的示意图，左右两边存储的数据是完全相同的。
        
![](https://live.staticflickr.com/65535/50588934826_3b405324ea_n.jpg)
         
- 可用容量：不超过较小的那边硬盘的容量总和。
+ 优点：
    - 读取性能翻倍。
    - 提供数据冗余，如果其中一块数据丢失，可以通过另一块还原。
+ 缺点：
    - 磁盘的利用率低，成本高。
       
### 1.1.9.  RAID 2（已淘汰）
>原理：RAID 2 本质上是 RAID 0，只是加入了汉明码来做数据的纠错。以此来优化 RAID 0。
- 汉明码：（Hamming Code）是广泛用于内存和磁盘纠错的编码。汉明码不仅可以用来检测转移数据时发生的错误，还可以用来修正错误。（要注意的是，汉明码只能发现和修正一位错误，对于两位或者两位以上的错误无法正确和发现）

+ 优点：
    - 加入了数据纠错机制
+ 缺点：
    - 成本增高，需要额外的盘做汉明码纠错
       
### 1.1.10. RAID3
>原理：RAID 3 使用字节级别的条带化技术，并采用专用的奇偶校验磁盘。RAID 3 阵列能在一个磁盘出现故障的情况下确保数据不丢失。如果一个物理磁盘出现故障，该磁盘上的数据可以重建到更换磁盘上。如果数据尚未重建到更换驱动器上，而此时又有一个磁盘出现故障，那么阵列中的所有数据都将丢失。本质上和 RAID 0 相同，与 RAID 2 相似，作为 RAID 0 的优化版本。
         
下图是 RAID 3 的实现架构图，图中 `Disk 4` 就是那块专用的奇偶校验磁盘。
          
![](https://live.staticflickr.com/65535/50588934941_a308b7c18f_n.jpg)
        
+ 优点：
    - 加入了数据纠错机制。
+ 缺点：
    - 做奇偶校验会消耗系统性能，容易导致系统出现性能瓶颈。
- 变种（RAID3+Spare**图中最后一个A3应该为A4**）
      
![](https://live.staticflickr.com/65535/50588186158_6aea07978d_n.jpg)
 
这种变种在主磁盘遇到故障的时候不需要立即处理，Spare 磁盘会无缝顶替上去。
         
### 1.1.11. RAID4
>原理：和 RAID 3 一样，唯一的区别是在数据分割上 RAID 3 对数据的访问是按位进行的，RAID 4 是以数据块为单位。
        
图和 RAID 3 一样，这种 RAID 在生产环境中几乎不用。
      
### 1.1.12. RAID5
>原理：RAID 5 综合了 RAID 0 的条带化技术以及阵列数据冗余技术（阵列最少包括三个磁盘）。RAID 3 和 RAID 5 之间的区别在于，RAID 3 配置提供的性能更高，但总容量略低。数据会在所有磁盘之间分条，并且每个数据块的奇偶校验块 (P) 写入到同一条带上。如果一个物理磁盘出现故障，该磁盘上的数据可以重建到更换磁盘上。单个磁盘出现故障时，数据不会丢失，但如果数据尚未重建到更换驱动器上，而此时又有一个磁盘出现故障，那么阵列中的所有数据都将丢失。
          
下图是实现的架构图，其中能够看到，Ap-Dp 奇偶校验是放到和数据同一条带上的。
        
![](https://live.staticflickr.com/65535/50589052212_1b9455844a_n.jpg)
       
+ 优点：
    - 读写性能高。
    - 有校验机制。
    - 空间利用率高。
+ 缺点：
    - 组成 RAID 5 的磁盘越多，安全性能越差，容易丢失数据。连续两块硬盘损坏，数据就找不回来了。
- 变种（RAID 5 + Spare）
       
![](https://live.staticflickr.com/65535/50588935051_8b948039cb_n.jpg)
       
这种变种在主磁盘遇到故障的时候不需要立即处理，Spare 磁盘会无缝顶替上去。
         
### 1.1.13. RAID6
>原理：与 RAID 5 相比，RAID 6 增加了第二个独立的奇偶校验信息块，双重奇偶校验，在 RAID 6 中，数据会在所有磁盘（最少四个）间进行分条，并且每个数据块的两个奇偶校验块（如下图中的 p 和 q）写入到同一条带上。如果一个物理磁盘出现故障，该磁盘上的数据可以重建到更换磁盘上。这种 RAID 模式最多允许两个磁盘出故障而不丢失数据，而且它能更快地重建故障磁盘上的数据。
        
![](https://live.staticflickr.com/65535/50588186168_fce6b190fb_n.jpg)
       
+ 优点：
    - 读取性能好。
    - 有奇偶校验机制。
+ 缺点：
    - 成本高，写入性能差。
       
常用的RAID6技术有：
- RAID6 P+Q
- RAID6 DP
          
#### 1.1.13.1. RAID6 P+Q工作原理
![](https://live.staticflickr.com/65535/50589351241_8de4fe4df6_k.jpg)
       
#### 1.1.13.2. RAID6 DP工作原理
![](https://live.staticflickr.com/65535/50588604293_6c541fd6e5_k.jpg)
       
### 1.1.14. RAID7
RAID 7 并非公开的 RAID 标准，而是 Storage Compute rCorporation 公司的专利硬体产品名称。
       
![](https://live.staticflickr.com/65535/50589052202_994c483cff_n.jpg)
        
### 1.1.15. RAID01
>原理：RAID 0 + RAID 1，两边都是条带化的 RAID 0 存储数据，然后互为备份，组成镜像存储 RAID 1。
       
下图是 RAID 01 的架构图，在 RAID 01 阵列中，最多允许两个磁盘出现故障而不会丢失数据，但故障磁盘必须属于同一 RAID 0 队列。在图中，也就是当磁盘 1 和磁盘 2 出现故障时，数据会保存到磁盘 3 和磁盘 4。
       
![](https://live.staticflickr.com/65535/50588185998_967d6a5d7d_n.jpg)
       
+ 优点：
    - 有数据备份，出现单点故障时可以恢复数据。
+ 缺点：
    - 成本高。
       
### 1.1.16. RAID10
>原理：RAID 1 + RAID 0，它合并了其他级别（尤其是 RAID 1 和 RAID 0）特点的另一种 RAID 级别。这是一种“镜像集条带”，意思是数据在两个镜像阵列间分条。“条带化”在阵列之间发生，而“镜像”是在相同的阵列中出现，两种技术的组合加快了重建的速度。RAID 10 阵列包含的磁盘数应为四的倍数。
        
下图是 RAID 10 的架构图，在 RAID 10 阵列中，每个镜像对中，可以有一个磁盘出现故障而不丢失数据。不过，故障磁盘所在阵列的工作磁盘会成为整个阵列中的弱点。如果镜像对中的另一个磁盘也发生故障，则会丢失整个阵列。
         
![](https://live.staticflickr.com/65535/50589052062_9897a3d9c8_n.jpg)
        
## 1.2. RAID2.0+技术
### 1.2.1. RAID技术演变
![](https://live.staticflickr.com/65535/50588700933_a5aa8a493a_k.jpg)
       
### 1.2.2. RAID2.0+基本原理
![](https://live.staticflickr.com/65535/50588700603_4a5ed63ed0_k.jpg)
          
### 1.2.3. RAID2.0+重构原理
![](https://live.staticflickr.com/65535/50588699618_ffdfbb252c_k.jpg)
      
### 1.2.4. RAID2.0+软件逻辑对象
![](https://live.staticflickr.com/65535/50589563367_c4fa1ebed4_k.jpg>)
       
### 1.2.5. 硬盘域
硬盘域是一堆硬盘的组合（可以是整个系统所有硬盘）这些硬盘整合并预留热备容量后统一向存储池提供存储资源。
        
![](https://live.staticflickr.com/65535/50589656572_35345397f6_k.jpg)
       
### Storage Pool & Tier
