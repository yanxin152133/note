# 1. RAID技术
## 1.1. 传统RAID技术
### 1.1.1. RAID技术背景
>在单机时代，采用单块磁盘进行数据存储和读写的方式，由于寻址和读写的时间消耗，导致I/O性能非常低，且存储容量还会受到限制。另外，单块磁盘极其容易出现物理故障，经常导致数据的丢失。因此大家就在想，有没有一种办法将多块独立的磁盘结合在一起组成一个技术方案，来提高数据的可靠性和I/O性能呢。
          
![](https://live.staticflickr.com/65535/50586207996_c3e06172eb_h.jpg)
      
### 1.1.2. RAID基本概念
>RAID （ Redundant Array of Independent Disks ）即独立磁盘冗余阵列，简称为「磁盘阵列」，旧称廉价磁盘冗余阵列（Redundant Array of Inexpensive Disks）,其实就是用多个独立的磁盘组成在一起形成一个大的磁盘系统，从而实现比单块磁盘更好的存储性能和更高的可靠性。
      
实现方法：硬件RAID和软件RAID。
       
### 1.1.3. RAID的数据组织形式
- 硬盘的条带化：将硬盘空间按照设定的大小分为多个条带，数据写入时也按照条带的大小来划分数据模块。
- 条带（strip）：硬盘中单个或者多个连续的扇区构成一个条带，是组成分条的元素。
- 分条（stripe）：同一硬盘阵列中的多个硬盘驱动器上的相同“位置”（或者说是相同编号）的条带。
        
![](https://live.staticflickr.com/65535/50585513133_32722ab28d_h.jpg)
      
### 1.1.4. RAID的数据保护方式
- 方法一：镜像（Mirroring），在另一块冗余的硬盘上保存数据的副本。
+ 方法二：奇偶校验算法（XOR）。
    - XOR运算广泛地使用在数字电子和计算机科学中。
    - XOR校验的算法--**相同为假，相异为真**。
       
![](https://live.staticflickr.com/65535/50588860077_90a0357283_h.jpg)
        
### 1.1.5. 常用RAID级别与分类标准
根据不同的组合方式可以分为不同的RAID级别。
             
![](https://live.staticflickr.com/65535/50588000558_d343b5ac7e_h.jpg)
        
### 1.1.6. 磁盘阵列比较表
|RAID等级|最少硬盘|最大容错|可用容量|读取性能|写入性能|安全性|目的|应用产业|
|----|----|----|----|----|----|----|----|----|
|单一硬盘|（参考）|0|1|1|1|无|||
|JBOD|1|0|n|1|1|无（同RAID0）|增加容量|个人（暂时）存储备份|
|0|2|0|n|n|n|一个硬盘异常，全部硬盘都会异常|追求最大容量、速度|影片剪接缓存用途|
|1|2|n-1|1|n|1|高，一个正常即可|追求最大安全性|个人、企业备份|
|5|3|1|n-1|n-1|n-1|中下至中|追求最大容量、最小预算|个人、小型企业备份|
|6|4|2|n-2|n-2|n-2|中至中高,仅安全性较RAID 5高|同RAID 5，但较安全|个人、企业备份|
|10|4|||||高|综合RAID 0/1优点，理论速度较快|大型数据库、服务器|
|50|6|||||高|提升资料安全||
|60|8|||||高|提升资料安全||
       
1. n代表硬盘总数
2. JBOD（Just a Bunch Of Disks）指将数个物理硬盘，在操作系统中合并成一个逻辑硬盘，以直接增加容量
3. 依不同 RAID 厂商实现算法对于性能表现会有不同，性能公式仅供参考
4. RAID 10、50、60 依实现 Parity 不同公式也不同
       
### 1.1.7. RAID0
>原理：将数据条带化，最少需要两块硬盘（每块硬盘的容量一样，实际生产环境中建议使用同品牌同型号同批次同容量的硬盘组成 RAID 0），即将所有组成 RAID 0 的硬盘的可用容量组合在一起，形成计算机上的一个逻辑卷。通俗的讲就是至少使用两块硬盘来存储数据，但是我要存储的数据不是全部存在某一块硬盘上，而是把我要存储的数据分成均等的多部分，然后平均分散存储在组成 RAID 0 的磁盘阵列上。
         
下图是用四块硬盘组成 RAID 0 的示意图，其中每块硬盘都被分成 ABCD 四个条带，然后我要存数据就先存把数据均分成四部分，如果 A1 能存下其中一份，那就直接将四部分分别存入 A1-A4，如果存不下就先存满 A1-A4，剩下的按同样的方式存 B1-B4，以此类推。
       
![](https://live.staticflickr.com/65535/50596348922_7386f9341c_z.jpg)

- 硬盘数量（最少）：2 
+ 优点：
    - 提高读写速度，对硬盘的总容量没有损失
    - 处理大文件很快
+ 缺点：
    - 一旦阵列中某块硬盘损坏了，所有数据将不可恢复。
- 应用：RAID 0 是要求最高速度和最大容量的用户的理想选择。要处理超大型文件的视频编缉人员可以使用 RAID 0 来编辑视频的多个流，以达到最佳播放效果。RAID 0 阵列更适于在频繁的文件处理（例如视频编辑）中使用，不宜用作唯一的存储备份解决方案，也不宜在关键任务系统中使用。
+ 如何计算RAID0的容量
    - RAID0中每个磁盘的容量都应相同
    - 存储容量的计算方式为`驱动器数乘以磁盘容量`，即`C = n*d`，其中：C=可用容量，n=磁盘数，d=磁盘容量
    - 例如：如果一个RAID0阵列中包含四个驱动器，每个驱动器的容量为1000GB，则阵列的总容量为4000GB，即`C=4*1000`
        
### 1.1.8. RAID1
>原理：镜像存储，RAID 1 至少需要两块硬盘组成，两块硬盘互为备份，存储的内容完全相同。建议硬盘容量大小也要一样，如果不一样，那实际可用容量不超过较小的那块硬盘的容量。
       
下图是 RAID 1 的示意图，左右两边存储的数据是完全相同的。
        
![](https://live.staticflickr.com/65535/50596349102_65fdb946e0_z.jpg)

- 硬盘数量（最少）：2 
- 可用容量：不超过较小的那边硬盘的容量总和。
+ 优点：
    - 读取性能翻倍。
    - 提供数据冗余，如果其中一块数据丢失，可以通过另一块还原。
+ 缺点：
    - 磁盘的利用率低，成本高。
- 应用：在一个磁盘出现故障时，RAID 1 可提供最高的数据安全性，但由于数据需写入两次，因此在写入时性能会略有下降。在更注重安全性而非速度的情况下，RAID 1 是理想选择。
+ 如何计算RAID1的容量
    - 在RAID1中（每个磁盘的容量相同），存储容量的计算方式为`驱动器数乘以磁盘容量再除以2`，即：`C=n*d/2`，其中C=可用容量，n=磁盘数，d=磁盘容量。
    - 例如：如果一个 RAID 1 阵列中包含四个驱动器，每个驱动器的容量为 1000GB，则阵列的总容量为2000GB，即`C = (4*1000)/2`
       
### 1.1.9.  RAID 2
>原理：RAID 2 本质上是 RAID 0，只是加入了汉明码来做数据的纠错。以此来优化 RAID 0。
- 汉明码：（Hamming Code）是广泛用于内存和磁盘纠错的编码。汉明码不仅可以用来检测转移数据时发生的错误，还可以用来修正错误。（要注意的是，汉明码只能发现和修正一位错误，对于两位或者两位以上的错误无法正确和发现）
         
- 硬盘数量（最少）：2
+ 优点：
    - 加入了数据纠错机制
+ 缺点：
    - 成本增高，需要额外的盘做汉明码纠错
       
### 1.1.10. RAID3
>原理：RAID 3 使用字节级别的条带化技术，并采用专用的奇偶校验磁盘。RAID 3 阵列能在一个磁盘出现故障的情况下确保数据不丢失。如果一个物理磁盘出现故障，该磁盘上的数据可以重建到更换磁盘上。如果数据尚未重建到更换驱动器上，而此时又有一个磁盘出现故障，那么阵列中的所有数据都将丢失。本质上和 RAID 0 相同，与 RAID 2 相似，作为 RAID 0 的优化版本。
         
下图是 RAID 3 的实现架构图，图中 `Disk 4` 就是那块专用的奇偶校验磁盘。
          
![](https://live.staticflickr.com/65535/50595485713_556bde9491_z.jpg)
        
- 硬盘数量（最少）：3
+ 优点：
    - 加入了数据纠错机制。
+ 缺点：
    - 做奇偶校验会消耗系统性能，容易导致系统出现性能瓶颈。
- 应用：RAID 3 在要读取连续的长文件（如视频文件）的环境中可提供良好的数据安全性。由于数据是从奇偶校验块中读取，因此磁盘故障不会导致服务中断。RAID 3 适用于那些追求性能并要求持续访问数据的用户（如视频编辑人员）。对于密集使用不连续文件的用户来说，RAID 3 并非理想之选，因为专用的奇偶校验磁盘会影响随机读取性能。
+ 如何计算RAID3的容量
    - 在RAID3中（每个磁盘的容量相同），存储容量的计算方式为`驱动器数减一在乘以磁盘容量`，即：`C=(n-1)*d`，其中C=可用容量，n=磁盘数，d=磁盘容量。
    - 例如：每个驱动器的容量为 1000GB，则阵列的总容量为 3000GB，即：`C = (4-1)*1000`
         
### 1.1.11. RAID3+Spare
**图中最后一个A3应该为A4**
       
![](https://live.staticflickr.com/65535/50596348837_323ef372e8_z.jpg)
        
- 应用：RAID 3+Spare模式下，磁盘故障不需要立即处理，因为系统会使用热备用磁盘对自己进行重建，但故障磁盘还是应尽快更换。
+ 如何计算RAID3+Spare的容量
    - 在RAID3+Spare中（每个磁盘容量相同），存储容量的计算方式为`驱动器数减二再乘以磁盘容量`，即`C=(n-2)*d`，其中C=可用容量，n=磁盘数，d=磁盘容量。
    - 如果一个 RAID 3+Spare阵列中包含四个驱动器，每个驱动器的容量为 1000GB，则阵列的总容量为 2000GB，即`C = (4-2)*1000`

         
### 1.1.12. RAID4
>原理：和 RAID 3 一样，唯一的区别是在数据分割上 RAID 3 对数据的访问是按位进行的，RAID 4 是以数据块为单位。
        
图和 RAID 3 一样，这种 RAID 在生产环境中几乎不用。
       
- 硬盘数量（最少）：3
      
### 1.1.13. RAID5
>原理：RAID 5 综合了 RAID 0 的条带化技术以及阵列数据冗余技术（阵列最少包括三个磁盘）。RAID 5不是对存储的数据进行备份，而是把数据和相对应的奇偶校验信息存储到组成RAID5的各个磁盘上，并且奇偶校验信息和相对应的数据分别存储于不同的磁盘上。当RAID5的一个磁盘数据发生损坏后，可以利用剩下的数据和相应的奇偶校验信息去恢复被损坏的数据。RAID 5可以理解为是RAID 0和RAID 1的折衷方案。RAID 5可以为系统提供数据安全保障，但保障程度要比镜像低而磁盘空间利用率要比镜像高。RAID 5具有和RAID 0相近似的数据读取速度，只是因为多了一个奇偶校验信息，写入数据的速度相对单独写入一块硬盘的速度略慢，若使用“回写缓存”可以让性能改善不少。同时由于多个数据对应一个奇偶校验信息，RAID 5的磁盘空间利用率要比RAID 1高，存储成本相对较便宜。
            
- RAID 3 和 RAID 5 之间的区别在于，RAID 3 配置提供的性能更高，但总容量略低。数据会在所有磁盘之间分条，并且每个数据块的奇偶校验块 (P) 写入到同一条带上。如果一个物理磁盘出现故障，该磁盘上的数据可以重建到更换磁盘上。单个磁盘出现故障时，数据不会丢失，但如果数据尚未重建到更换驱动器上，而此时又有一个磁盘出现故障，那么阵列中的所有数据都将丢失。
          
下图是实现的架构图，其中能够看到，Ap-Dp 奇偶校验是放到和数据同一条带上的。
        
![](https://live.staticflickr.com/65535/50596228286_c4d655e5ac_z.jpg)
       
- 硬盘数量（最少）：3
+ 优点：
    - 读写性能高。
    - 有校验机制。
    - 空间利用率高。
+ 缺点：
    - 组成 RAID 5 的磁盘越多，安全性能越差，容易丢失数据。连续两块硬盘损坏，数据就找不回来了。
- 应用：RAID 5 适用于归档，且适合那些追求性能并要求持续访问数据的用户（如视频编辑人员）使用。 
+ 如何计算RAID5的容量：
    - 在RAID5中（每个磁盘容量相同），存储容量的计算方式为`驱动器数减一再乘以磁盘容量`，即`C=(n-1)*d`,其中C=可用容量，n=磁盘数，d=磁盘容量
    - 例如：如果一个 RAID 5 阵列中包含四个驱动器，每个驱动器的容量为 1000GB，则阵列的总容量为 3,000GB，即`C = (4-1)*1000`
        
### 1.1.14. RAID 5 + Spare
       
![](https://live.staticflickr.com/65535/50596228251_66a8961541_z.jpg)
       
- RAID 5+Spare是一种 RAID 5 阵列，其中有一个磁盘用作备用磁盘，用于在磁盘发生故障时立即重建系统。因此，至少需要四个磁盘。
- 如果一个物理磁盘发生故障，磁盘上的数据仍然可以访问，因为数据是从奇偶校验块中读取的。故障磁盘上的数据将重建到热备用磁盘上。当故障磁盘更换后，更换的磁盘便成为新的热备用磁盘。单个磁盘出现故障时，数据不会丢失，但如果系统尚未将数据重建到热备用磁盘上，而此时又有一个磁盘出现故障，那么阵列中的所有数据都将丢失。
- RAID 5+Spare的主要优点在于，在系统将数据重建至备用驱动器时用户仍可以继续访
问数据。它能提供良好的数据安全，但磁盘空间由于热备用磁盘的存在（在其他磁盘出现故障之后才使用）而受到限制。磁盘故障不需要立即处理，因为系统会使用热备用磁盘对自己进行重建，但故障磁盘还是应尽快更换。
+ 如何计算RAID 5 + Spare的容量
    - 在RAID 5 + Spare中（每个磁盘容量相同），存储容量的计算公式为`驱动器数减二再乘以磁盘容量`，即`C=(n-2)*d`，其中C=可用容量，n=磁盘数，d=磁盘容量
    - 例如：如果一个 RAID 5+Spare阵列中包含四个驱动器，每个驱动器的容量为1000GB，则阵列的总容量为 2000GB，即`C = (4-2)*1000`
         
### 1.1.15. RAID6
>原理：与 RAID 5 相比，RAID 6 增加了第二个独立的奇偶校验信息块，双重奇偶校验，在 RAID 6 中，数据会在所有磁盘（最少四个）间进行分条，并且每个数据块的两个奇偶校验块（如下图中的 p 和 q）写入到同一条带上。如果一个物理磁盘出现故障，该磁盘上的数据可以重建到更换磁盘上。这种 RAID 模式最多允许两个磁盘出故障而不丢失数据，而且它能更快地重建故障磁盘上的数据。
        
![](https://live.staticflickr.com/65535/50595485578_186c8402ac_z.jpg)

- 硬盘数量（最少）：4  
+ 优点：
    - 读取性能好。
    - 有奇偶校验机制。
+ 缺点：
    - 成本高，写入性能差。
- 应用：在驱动器出现故障时，RAID 6 能进行有效的重建，确保了数据的可靠性。为此，安全性要求较高，而性能要求不高的用户可以选择RAID 6。
+ 如何计算RAID6的存储容量
    - 在RAID6中（每个磁盘容量相同），存储容量的计算方式为`驱动器数减二再乘以磁盘容量`，即`C=(n-2)*d`，其中C=可用容量，n=磁盘数，d=磁盘容量
    - 例如：如果一个 RAID 6 阵列中包含五个驱动器，每个驱动器的容量为 1000GB，则阵列的总容量为 3000GB，即`C = (5-2)*1000`
       
常用的RAID6技术有：
- RAID6 P+Q
- RAID6 DP
          
#### 1.1.15.1. RAID6 P+Q工作原理
![](https://live.staticflickr.com/65535/50589351241_8de4fe4df6_k.jpg)
       
#### 1.1.15.2. RAID6 DP工作原理
![](https://live.staticflickr.com/65535/50588604293_6c541fd6e5_k.jpg)
       
### 1.1.16. RAID7
RAID 7 并非公开的 RAID 标准，而是 Storage Compute rCorporation 公司的专利硬体产品名称。
       
![](https://live.staticflickr.com/65535/50589052202_994c483cff_n.jpg)
        
### 1.1.17. RAID01
>原理：RAID 0 + RAID 1，两边都是条带化的 RAID 0 存储数据，然后互为备份，组成镜像存储 RAID 1。
>RAID 01 是一种安全的 RAID 模式，由条带集的镜像组成。RAID 01 阵列包含的磁盘数应为四的倍数。
       
下图是 RAID 01 的架构图，在 RAID 01 阵列中，最多允许两个磁盘出现故障而不会丢失数据，但故障磁盘必须属于同一 RAID 0 队列。在图中，也就是当磁盘 1 和磁盘 2 出现故障时，数据会保存到磁盘 3 和磁盘 4。
       
![](https://live.staticflickr.com/65535/50596228196_2b0e42b4be_z.jpg)
       
+ 优点：
    - 有数据备份，出现单点故障时可以恢复数据。
+ 缺点：
    - 成本高。
- 应用：RAID 0+1 使用 RAID 0 条带技术来提供良好的速度，但设备的可用容量会减少一半（假设阵列中所有磁盘的容量都相同）。
+ 如何计算RAID01的容量
    - 在RAID01中（每个磁盘的容量相同），存储容量的计算方式为`驱动器数乘以磁盘容量再除以2`，即`C=n*d/2`，其中C=可用容量，n=磁盘数，d=磁盘容量
    - 例如：如果一个 RAID 01 阵列中包含四个驱动器，每个驱动器的容量为 1000GB，则阵列的总容量为 2000GB，即`C = (4*1000)/2`
       
### 1.1.18. RAID10
>原理：RAID 1 + RAID 0，它合并了其他级别（尤其是 RAID 1 和 RAID 0）特点的另一种 RAID 级别。这是一种“镜像集条带”，意思是数据在两个镜像阵列间分条。“条带化”在阵列之间发生，而“镜像”是在相同的阵列中出现，两种技术的组合加快了重建的速度。RAID 10 阵列包含的磁盘数应为四的倍数。
        
下图是 RAID 10 的架构图，在 RAID 10 阵列中，每个镜像对中，可以有一个磁盘出现故障而不丢失数据。不过，故障磁盘所在阵列的工作磁盘会成为整个阵列中的弱点。如果镜像对中的另一个磁盘也发生故障，则会丢失整个阵列。
         
![](https://live.staticflickr.com/65535/50596228151_e3a40562e4_z.jpg)
         
- 硬盘数量（最少）：4
- 应用：RAID 10 使用 RAID 0 条带技术来 提供良好的速度，但设备的可用容量会减少一半（假设阵列中所有磁盘的容量都相同）。
+ 如何计算RAID10的容量
    - 在RAID10中（每个磁盘的容量相同），存储容量的计算方式为`驱动器数乘以磁盘容量再除以2`，即`C=n*d/2`，其中C=可用容量，n=磁盘数，d=磁盘容量
    - 例如：如果一个 RAID 10 阵列中包含四个驱动器，每个驱动器的容量为 1000GB，则阵列的总容量为 2000GB，即`C = (4*1000)/2`
         
## 1.2. RAID2.0+技术
### 1.2.1. RAID技术演变
![](https://live.staticflickr.com/65535/50588700933_a5aa8a493a_k.jpg)
       
### 1.2.2. RAID2.0+基本原理
![](https://live.staticflickr.com/65535/50588700603_4a5ed63ed0_k.jpg)
          
### 1.2.3. RAID2.0+重构原理
![](https://live.staticflickr.com/65535/50588699618_ffdfbb252c_k.jpg)
      
### 1.2.4. RAID2.0+软件逻辑对象
![](https://live.staticflickr.com/65535/50589563367_c4fa1ebed4_k.jpg>)
       
### 1.2.5. 硬盘域
硬盘域是一堆硬盘的组合（可以是整个系统所有硬盘）这些硬盘整合并预留热备容量后统一向存储池提供存储资源。
        
![](https://live.staticflickr.com/65535/50589656572_35345397f6_k.jpg)
       
### 1.2.6. Storage Pool & Tier
- Storage Pool即存储池，是存放存储空间资源的容器，所有应用服务器使用的存储空间都来自于存储池。
- Tier即存储层级，存储池中性能类似的存储介质集合，用于管理不同性能的存储介质，以便为不同性能要求的应用提供不同存储空间。
       
|存储层级|层级名称|支持硬盘类型|应用|
|----|----|----|----|
|Tier0|高性能层|SSD|性能和价格较高，适合存放访问频率很高的数据|
|Tier1|性能层|SAS|性能较高，价格适中，适合存放访问频率中等的数据|
|Tier2|容量层|NL-SAS|性能较低，价格最低且单盘容量大，适合存放大容量的数据以及访问频率较低的数据|
        
|RAID级别|RAID策略|
|----|----|
|RAID1|1D+1D,1D+1D+1D+1D|
|RAID10|系统自动选择2D+2D或4D+4D|
|RAID3|2D+1P，4D+1P，8D+1P|
|RAID5|2D+1P，4D+1P，8D+1P|
|RAID50|(2D+1P)*2,(4D+1P)*2,(8D+1P)*2|
|RAID6|2D+2P,4D+2P,8D+2P,16D+2P|
        
### 1.2.7. Disk Group(DG)
Disk Group(DG)即硬盘组，由硬盘域内相同类型的多个硬盘组成的集合，硬盘类型包括SSD、SAS和NL-SAS三种。
       
### 1.2.8. LD
Logic Drive (LD)即逻辑磁盘，是被存储系统所管理的硬盘，和物理硬盘一一对应。
       
![](https://live.staticflickr.com/65535/50588793188_6d8faf4b03_h.jpg)
        
### 1.2.9. CK
Chunk简称CK，是存储池内的硬盘空间切分成若干固定大小的物理空间，是组成RAID的基本单位。
       
![](https://live.staticflickr.com/65535/50589539021_211eb4179b_h.jpg)
        
### 1.2.10. CKG
Chunk Group简称CKG，是由来自于同一个DG内不同硬盘的CK按照RAID算法组成的逻辑存储单元，是存储池从硬盘域上分配资源的最小单位。
           
![](https://live.staticflickr.com/65535/50588793013_767e23238b_h.jpg)
       
### 1.2.11. Extent
Extent是在CKG基础上划分的固定大小的逻辑存储空间，大小可调，是热点数据统计和迁移的最小单元（数据迁移粒度），也是存储池中申请空间、释放空间的最小单位。
       
![](https://live.staticflickr.com/65535/50589656412_e18a845187_h.jpg)
        
### 1.2.12. Grain
在Thin LUN模式下，Extent按照固定大小被进一步划分为更细粒度的块，这些块称之为Grain。Thin LUN以Grain为粒度进行空间分配，Grain内的LBA是连续的。
           
![](https://live.staticflickr.com/65535/50589656397_4d2d099833_h.jpg)
        
### 1.2.13. Volume & LUN
- Volume即卷，是存储系统内部管理对象。
- LUN是可以直接映射给主机读写的存储单元，是Volume对象的对外体现。
      
![](https://live.staticflickr.com/65535/50589656357_8d45838aff_h.jpg)
       
## 1.3. 其他RAID技术
### 1.3.1. 华为动态RAID算法
![](https://live.staticflickr.com/65535/50593031921_2617569f16_h.jpg)
       
### 1.3.2. RAID-TP
![](https://live.staticflickr.com/65535/50593031836_9fa48b0373_h.jpg)
